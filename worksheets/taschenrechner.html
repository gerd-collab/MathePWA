<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wissenschaftlicher Taschenrechner</title>
    <style>
        /* Dark Mode Styling */
        body {
            background-color: #121212;
            color: #ffffff;
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            margin: 0;
            padding: 20px;
        }

        /* Back Button Styling */
        .back-button {
            align-self: flex-start;
            background-color: #1e1e1e;
            border: none;
            color: #ffffff;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            font-size: 16px;
            margin-bottom: 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .back-button:hover {
            background-color: #333333;
        }

        /* Calculator Container */
        .calculator {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px #000;
            width: 350px;
        }

        /* Display Styling */
        .display {
            background-color: #2c2c2c;
            color: #ffffff;
            font-size: 24px;
            padding: 10px;
            border-radius: 5px;
            text-align: right;
            overflow-x: auto;
            word-wrap: break-word;
            min-height: 50px;
            margin-bottom: 10px;
        }

        /* Buttons Grid */
        .buttons {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-gap: 10px;
        }

        /* Button Styling */
        .button {
            background-color: #3a3a3a;
            border: none;
            color: #ffffff;
            padding: 15px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .button:hover {
            background-color: #555555;
        }

        /* Span Two Columns */
        .span-two {
            grid-column: span 2;
        }

        /* Specific Button Colors */
        .button.function {
            background-color: #ff9500;
        }

        .button.function:hover {
            background-color: #ffa733;
        }

        .button.operator {
            background-color: #ff2d55;
        }

        .button.operator:hover {
            background-color: #ff5e80;
        }

        .button.equal {
            background-color: #34c759;
            grid-column: span 2;
        }

        .button.equal:hover {
            background-color: #5cd68d;
        }

        .button.clear {
            background-color: #ff3b30;
        }

        .button.clear:hover {
            background-color: #ff6b6b;
        }

        /* Memory Buttons Styling */
        .button.memory {
            background-color: #5856d6;
        }

        .button.memory:hover {
            background-color: #7a7be0;
        }

        /* +/- Button Styling */
        .button.toggle-sign {
            background-color: #007BFF; /* Blau */
            color: #ffffff;
        }

        .button.toggle-sign:hover {
            background-color: #339CFF; /* Hellere Blautönung beim Hover */
        }
    </style>
</head>
<body>

    <!-- Zurück-Button -->
    <button class="back-button" onclick="window.location.href='../index.html'">← Zurück</button>

    <!-- Taschenrechner Container -->
    <div class="calculator">
        <!-- Display -->
        <div id="display" class="display">0</div>

        <!-- Buttons -->
        <div class="buttons">
            <!-- Speicher Buttons (Neue Zeile) -->
            <button class="button memory" onclick="memoryClear()">MC</button>
            <button class="button memory" onclick="memoryRecall()">MR</button>
            <button class="button memory" onclick="memoryStore()">MS</button>
            <button class="button memory" onclick="memoryAdd()">M+</button>
            <button class="button memory" onclick="memorySubtract()">M-</button>

            <!-- Row 1 -->
            <button class="button function" onclick="appendFunction('sin(')">sin</button>
            <button class="button function" onclick="appendFunction('cos(')">cos</button>
            <button class="button function" onclick="appendFunction('tan(')">tan</button>
            <button class="button operator" onclick="appendOperator('(')">(</button>
            <button class="button operator" onclick="appendOperator(')')">)</button>

            <!-- Row 2 -->
            <button class="button function" onclick="appendFunction('log(')">log</button>
            <button class="button function" onclick="appendFunction('ln(')">ln</button>
            <button class="button function" onclick="appendFunction('sqrt(')">√</button>
            <button class="button operator" onclick="appendOperator('^')">^</button>
            <button class="button clear" onclick="clearDisplay()">C</button>

            <!-- Row 3 -->
            <button class="button" onclick="appendNumber('7')">7</button>
            <button class="button" onclick="appendNumber('8')">8</button>
            <button class="button" onclick="appendNumber('9')">9</button>
            <button class="button operator" onclick="appendOperator('/')">÷</button>
            <button class="button operator" onclick="backspace()">⌫</button>

            <!-- Row 4 -->
            <button class="button" onclick="appendNumber('4')">4</button>
            <button class="button" onclick="appendNumber('5')">5</button>
            <button class="button" onclick="appendNumber('6')">6</button>
            <button class="button operator" onclick="appendOperator('*')">×</button>
            <button class="button" onclick="appendConstant('π')">π</button>

            <!-- Row 5 -->
            <button class="button" onclick="appendNumber('1')">1</button>
            <button class="button" onclick="appendNumber('2')">2</button>
            <button class="button" onclick="appendNumber('3')">3</button>
            <button class="button operator" onclick="appendOperator('-')">−</button>
            <button class="button" onclick="appendConstant('e')">e</button>

            <!-- Row 6 -->
            <button class="button span-two" onclick="appendNumber('0')">0</button>
            <button class="button" onclick="appendDecimal()">.</button>
            <button class="button operator" onclick="appendOperator('+')">+</button>
            <button class="button toggle-sign" onclick="toggleSign()">±</button>
            <button class="button equal" onclick="calculate()">=</button>
        </div>
    </div>

    <script>
        const display = document.getElementById('display');
        let memory = 0;

        // Append number to display
        function appendNumber(number) {
            if (display.innerText === '0' || display.innerText === 'Error') {
                display.innerText = number;
            } else {
                display.innerText += number;
            }
        }

        // Append decimal point
        function appendDecimal() {
            if (display.innerText === 'Error') return;
            // Prevent multiple decimals in a number
            const parts = display.innerText.split(/[\+\-\*\/\^\(\)]/);
            const lastPart = parts[parts.length - 1];
            if (!lastPart.includes('.')) {
                display.innerText += '.';
            }
        }

        // Append operator to display
        function appendOperator(operator) {
            if (display.innerText === 'Error') return;
            // Entfernt '0' vor einem Operator, falls erforderlich
            if (display.innerText === '0' && operator === '-') {
                display.innerText = '-';
                return;
            }

            const lastChar = display.innerText.slice(-1);
            if ('+-*/^'.includes(lastChar)) {
                display.innerText = display.innerText.slice(0, -1) + operator;
            } else {
                display.innerText += operator;
            }
        }

        // Append function to display
        function appendFunction(func) {
            if (display.innerText === '0' || display.innerText === 'Error') {
                display.innerText = func;
            } else {
                display.innerText += func;
            }
        }

        // Append constants like π und e
        function appendConstant(constant) {
            if (display.innerText === '0' || display.innerText === 'Error') {
                if (constant === 'π') {
                    display.innerText = 'pi';
                } else if (constant === 'e') {
                    display.innerText = 'e';
                }
            } else {
                if (constant === 'π') {
                    display.innerText += 'pi';
                } else if (constant === 'e') {
                    display.innerText += 'e';
                }
            }
        }

        // Clear display
        function clearDisplay() {
            display.innerText = '0';
        }

        // Backspace function
        function backspace() {
            if (display.innerText === 'Error') {
                display.innerText = '0';
                return;
            }
            if (display.innerText.length > 1) {
                display.innerText = display.innerText.slice(0, -1);
            } else {
                display.innerText = '0';
            }
        }

        // Toggle sign function
        function toggleSign() {
            if (display.innerText === '0' || display.innerText === 'Error') return;

            // Regex to find the last number in the expression
            const regex = /(-?\d+(\.\d+)?)$/;
            const match = display.innerText.match(regex);
            if (match) {
                const number = match[0];
                const toggledNumber = number.startsWith('-') ? number.slice(1) : '-' + number;
                display.innerText = display.innerText.slice(0, -number.length) + toggledNumber;
            }
        }

        // Memory functions
        function memoryClear() {
            memory = 0;
        }

        function memoryRecall() {
            if (display.innerText === 'Error') {
                display.innerText = '0';
            }
            display.innerText = formatNumber(memory);
        }

        function memoryStore() {
            try {
                const value = evaluateExpression(display.innerText);
                memory = value;
            } catch (error) {
                display.innerText = 'Error';
            }
        }

        function memoryAdd() {
            try {
                const value = evaluateExpression(display.innerText);
                memory += value;
            } catch (error) {
                display.innerText = 'Error';
            }
        }

        function memorySubtract() {
            try {
                const value = evaluateExpression(display.innerText);
                memory -= value;
            } catch (error) {
                display.innerText = 'Error';
            }
        }

        // Calculate the result
        function calculate() {
            try {
                const result = evaluateExpression(display.innerText);
                display.innerText = formatNumber(result);
            } catch (error) {
                display.innerText = 'Error';
            }
        }

        // Helper function to evaluate expressions
        function evaluateExpression(expression) {
            // Replace constants
            expression = expression.replace(/pi/g, Math.PI);
            expression = expression.replace(/e/g, Math.E);

            // Replace functions with Math equivalents
            expression = expression.replace(/sin\(/g, 'Math.sin(degToRad(');
            expression = expression.replace(/cos\(/g, 'Math.cos(degToRad(');
            expression = expression.replace(/tan\(/g, 'Math.tan(degToRad(');
            expression = expression.replace(/log\(/g, 'Math.log10(');
            expression = expression.replace(/ln\(/g, 'Math.log(');
            expression = expression.replace(/sqrt\(/g, 'Math.sqrt(');
            expression = expression.replace(/\^/g, '**');

            // Function to convert degrees to radians
            function degToRad(degrees) {
                return degrees * (Math.PI / 180);
            }

            // Evaluate the expression
            const result = eval(expression);
            if (isNaN(result) || !isFinite(result)) {
                throw new Error('Invalid Calculation');
            }
            return result;
        }

        // Helper function to format numbers (optional, for better readability)
        function formatNumber(num) {
            if (Number.isInteger(num)) {
                return num.toString();
            } else {
                return parseFloat(num.toFixed(10)).toString(); // Limit to 10 decimal places
            }
        }
    </script>

</body>
</html>
